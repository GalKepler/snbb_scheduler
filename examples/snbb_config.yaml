# snbb_config.yaml — production configuration for the SNBB cluster
#
# Copy this file to /etc/snbb/config.yaml and adjust the paths to match
# your site. Everything under "procedures" is optional; remove the block
# entirely to use the built-in defaults (bids, qsiprep, freesurfer).

# ---------------------------------------------------------------------------
# Root directories
# ---------------------------------------------------------------------------
dicom_root:       /data/snbb/dicom
bids_root:        /data/snbb/bids
derivatives_root: /data/snbb/derivatives
state_file:       /data/snbb/.scheduler_state.parquet

# ---------------------------------------------------------------------------
# Slurm settings
# ---------------------------------------------------------------------------
slurm_partition: normal
slurm_account:   snbb

# ---------------------------------------------------------------------------
# Processing procedures — in dependency order
# ---------------------------------------------------------------------------
procedures:

  # BIDS conversion (heudiconv / dcm2bids)
  # Completion: at least one .nii.gz anywhere in the session directory
  - name: bids
    output_dir: ""              # lives in bids_root, not derivatives_root
    script: snbb_run_bids.sh
    scope: session
    depends_on: []
    completion_marker: "**/*.nii.gz"

  # DWI preprocessing
  # Completion: output directory is non-empty
  - name: qsiprep
    output_dir: qsiprep
    script: snbb_run_qsiprep.sh
    scope: session
    depends_on: [bids]
    completion_marker: null

  # Cortical reconstruction (one run covers all sessions for a subject)
  # Completion: recon-all writes this marker file when it finishes
  - name: freesurfer
    output_dir: freesurfer
    script: snbb_run_freesurfer.sh
    scope: subject
    depends_on: [bids]
    completion_marker: "scripts/recon-all.done"

  # DWI reconstruction (requires qsiprep output)
  - name: qsirecon
    output_dir: qsirecon
    script: snbb_run_qsirecon.sh
    scope: session
    depends_on: [qsiprep]
    completion_marker: null

  # fMRI preprocessing
  # Completion: fmriprep writes an HTML report on success
  - name: fmriprep
    output_dir: fmriprep
    script: snbb_run_fmriprep.sh
    scope: session
    depends_on: [bids]
    completion_marker: "**/*.html"
